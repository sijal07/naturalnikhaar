<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Razorpay Payment</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
    <h1>Redirecting to Razorpay...</h1>
    <h1>Please do not refresh or close this page.</h1>

    <div id="rzp-button" style="display: none;">Pay Now</div>

    <script>
        var options = {
            "key": "{{ razorpay_key }}",
            "amount": "{{ razorpay_amount }}",
            "currency": "INR",
            "name": "NATURAL NIKHAAR",
            "description": "Order #{{ order_id }}",
            "order_id": "{{ razorpay_order_id }}",
            "prefill": {
                "name": "{{ name }}",
                "email": "{{ email }}",
                "contact": "{{ phone }}"
            },
            "handler": function (response) {
                // Submit payment details to your server
                var form = document.createElement('form');
                form.method = 'POST';
                form.action = 'http://127.0.0.1:8000/handlerequest/';  // Your callback URL

                var fields = [
                    ['razorpay_payment_id', response.razorpay_payment_id],
                    ['razorpay_order_id', response.razorpay_order_id],
                    ['razorpay_signature', response.razorpay_signature]
                ];

                fields.forEach(function(field) {
                    var input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = field[0];
                    input.value = field[1];
                    form.appendChild(input);
                });
                document.body.appendChild(form);
                form.submit();
                
                // After form submit, redirect to profile and refresh checkout
                setTimeout(function() {
                    window.location.href = '/profile/';  // Redirect to profile page
                    window.location.reload(true);        // Force refresh checkout/profile
                }, 1000);
            },
            "theme": {
                "color": "#3399cc"
            }
        };

        var rzp = new Razorpay(options);
        document.getElementById('rzp-button').onclick = function(e) {
            rzp.open();
            e.preventDefault();
        }
        // Auto-trigger payment
        rzp.open();
    </script>
</body>
</html>
